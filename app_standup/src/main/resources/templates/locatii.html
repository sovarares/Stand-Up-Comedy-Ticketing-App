<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>LocaÈ›ii</title>
    <link rel="stylesheet" th:href="@{/style.css}"/>
    <style> .sort-link { text-decoration: none; color: white; margin-left: 5px; } .active-sort-link { color: #FFD700 ; } </style>
</head>
<body>
<div class="container">
    <div class='topline'>
        <h1 style="margin:0;">LocaÈ›ii</h1>
        <div style="text-align: right;">
            <div th:if="${ses}">Salut, <b th:text="${ses.username}">user</b> (<span th:text="${ses.role}">role</span>)</div>
            <div><a class='link' th:href='@{/logout}'>Logout</a></div>
        </div>
    </div>
    <div th:if="${success}" style="color:green" th:text="${success}"></div>
    <div th:if="${error}" style="color:red" th:text="${error}"></div>

    <div class='card'>
        <form method='GET' th:action='@{/locatii}' class='search'>
            <input name='q' placeholder='CautÄƒ nume/adresÄƒ/oraÈ™' th:value="${search}" />
            <button>CautÄƒ</button>
        </form>

        <div th:if="${ses != null and ses.role == 'admin'}" class="actions" style="margin-bottom: 15px;">
            <details style="display: block;">
                <summary class='btn add' style="cursor: pointer; display: inline-block;">+ AdaugÄƒ locaÈ›ie (admin)</summary>
                <form method='POST' th:action='@{/locatie/add}' class='form-inline' style="margin-top: 10px; padding: 10px; border: 1px solid #e3e6ea; border-radius: 8px;">
                    <div style="flex: 1 1 45%; min-width: 200px;"><label>Nume LocaÈ›ie:</label><input name='nume' required/></div>
                    <div style="flex: 1 1 45%; min-width: 200px;"><label>Adresa:</label><input name='adresa' required/></div>
                    <div style="flex: 1 1 45%; min-width: 200px; margin-top: 10px;"><label>OraÈ™:</label><input name='oras'/></div>
                    <div style="flex: 1 1 45%; min-width: 200px; margin-top: 10px;"><label>Capacitate:</label><input name='capacitate' type="number" min="0"/></div>
                    <div style="flex: 1 1 100%; text-align: right; margin-top: 10px;"><button type='submit' class='btn'>AdaugÄƒ</button></div>
                </form>
            </details>
        </div>

        <table class='table'>
            <thead>
            <tr>
                <th>ID<a th:href="@{/locatii(q=${search}, sortBy='ID', sortDir=${sortBy == 'ID' and sortDir == 'ASC' ? 'DESC' : 'ASC'})}" th:classappend="${sortBy == 'ID' ? 'active-sort-link' : ''}" class="sort-link">â‡…</a></th>
                <th>Nume<a th:href="@{/locatii(q=${search}, sortBy='NUME', sortDir=${sortBy == 'NUME' and sortDir == 'ASC' ? 'DESC' : 'ASC'})}" class="sort-link">â‡…</a></th>
                <th>AdresÄƒ</th><th>OraÈ™</th><th>Capacitate</th>
                <th th:if="${ses != null and ses.role == 'admin'}">AcÈ›iuni</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="l : ${locatiiList}">
                <td th:text="${l.id}"></td><td th:text="${l.nume}"></td><td th:text="${l.adresa}"></td><td th:text="${l.oras}"></td><td th:text="${l.capacitate}"></td>
                <td th:if="${ses != null and ses.role == 'admin'}">
                    <div class="action-group">
                        <form style='display:inline' method='POST' th:action='@{/locatie/delete}' onsubmit="return confirm('Confirmi stergerea?')">
                            <input type='hidden' name='id' th:value="${l.id}"/><button class='btn del round'>X</button>
                        </form>
                        <details style='display:inline'>
                            <summary class='btn edit'>Edit</summary>
                            <form method='POST' th:action='@{/locatie/edit}' class='form-inline'>
                                <input type='hidden' name='id' th:value="${l.id}"/>
                                <input name='nume' th:value="${l.nume}"/><input name='adresa' th:value="${l.adresa}"/>
                                <input name='oras' th:value="${l.oras}"/><input name='capacitate' type="number" th:value="${l.capacitate}"/>
                                <button class='btn' type='submit'>SalveazÄƒ</button>
                            </form>
                        </details>
                    </div>
                </td>
            </tr>
            <tr th:if="${locatiiList.isEmpty()}"><td th:attr="colspan=${ses != null and ses.role == 'admin' ? 6 : 5}">Nu s-au gÄƒsit locaÈ›ii.</td></tr>
            </tbody>
        </table>
    </div>

    <div class="card" style="margin-top:20px; background:#f9f9f9;">
        <h3>ðŸ“… UrmÄƒtoarele 5 evenimente Ã®n locaÈ›iile noastre</h3>
        <ul th:if="${not #lists.isEmpty(upcomingShows)}">
            <li th:each="u : ${upcomingShows}" th:text="${'[' + u.data + '] ' + u.show + ' @ ' + u.loc}"></li>
        </ul>
        <p th:if="${#lists.isEmpty(upcomingShows)}">Nu existÄƒ spectacole programate curÃ¢nd.</p>
    </div>

    <div style='margin-top:12px;'>
        <a class='link' th:href='@{/spectacole}'>Spectacole</a> |
        <a class='link' th:href='@{/artisti}'>ArtiÈ™ti</a> |
        <span style="font-weight: bold; color: #555;">LocaÈ›ii</span> |
        <a class='link' th:href='@{/organizatori}'>Organizatori</a> |
        <a class='link' th:href='@{/bilete}'>Bilete</a>
        <span th:if="${ses != null and ses.role == 'admin'}"> | <a class='link' th:href='@{/raport}'>Raport</a></span>
    </div>
</div>
</body>
</html>