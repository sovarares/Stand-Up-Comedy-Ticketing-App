<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Artiști</title>
    <link rel="stylesheet" th:href="@{/style.css}"/>
    <style>
        .sort-link { text-decoration: none; color: white; margin-left: 5px; }
        .active-sort-link { color: #FFD700 ; }
    </style>
</head>
<body>
<div class="container">
    <div class='topline'>
        <h1 style="margin:0;">Artiști</h1>
        <div style="text-align: right;">
            <div th:if="${ses}">Salut, <b th:text="${ses.username}">user</b> (<span th:text="${ses.role}">role</span>)</div>
            <div><a class='link' th:href='@{/logout}'>Logout</a></div>
        </div>
    </div>
    <div th:if="${error}" style="color: red; margin-bottom: 10px;" th:text="${error}"></div>
    <div th:if="${success}" style="color: green; margin-bottom: 10px;" th:text="${success}"></div>

    <div class='card'>
        <form method='GET' th:action='@{/artisti}' class='search'>
            <input name='q' placeholder='Caută nume/prenume/naționalitate' th:value="${search}" />
            <button>Caută</button>
        </form>

        <div th:if="${ses != null and ses.role == 'admin'}" class="actions" style="margin-bottom: 15px;">
            <details style="display: block;">
                <summary class='btn add' style="cursor: pointer; display: inline-block;">+ Adaugă artist (admin)</summary>
                <form method='POST' th:action='@{/artist/add}' class='form-inline' style="margin-top: 10px; padding: 10px; border: 1px solid #e3e6ea; border-radius: 8px;">
                    <div style="flex: 1 1 45%; min-width: 200px;"><label>Nume:</label><input name='nume' required/></div>
                    <div style="flex: 1 1 45%; min-width: 200px;"><label>Prenume:</label><input name='prenume' required/></div>
                    <div style="flex: 1 1 45%; min-width: 200px; margin-top: 10px;"><label>Naționalitate:</label><input name='nationalitate'/></div>
                    <div style="flex: 1 1 45%; min-width: 200px; margin-top: 10px;"><label>Vârsta:</label><input name='varsta' type="number" min="0"/></div>
                    <div style="flex: 1 1 45%; min-width: 200px; margin-top: 10px;"><label>Experiență (Ani):</label><input name='experienta' type="number" min="0"/></div>
                    <div style="flex: 1 1 100%; text-align: right; margin-top: 10px;"><button type='submit' class='btn'>Adaugă</button></div>
                </form>
            </details>
        </div>

        <table class='table'>
            <thead>
            <tr>
                <th th:if="${ses != null and ses.role == 'admin'}">ID<a th:href="@{/artisti(q=${search}, sortBy='ID', sortDir=${sortBy == 'ID' and sortDir == 'ASC' ? 'DESC' : 'ASC'})}" th:classappend="${sortBy == 'ID' ? 'active-sort-link' : ''}" class="sort-link">⇅</a></th>
                <th>Nume<a th:href="@{/artisti(q=${search}, sortBy='NUME', sortDir=${sortBy == 'NUME' and sortDir == 'ASC' ? 'DESC' : 'ASC'})}" th:classappend="${sortBy == 'NUME' ? 'active-sort-link' : ''}" class="sort-link">⇅</a></th>
                <th>Prenume<a th:href="@{/artisti(q=${search}, sortBy='PRENUME', sortDir=${sortBy == 'PRENUME' and sortDir == 'ASC' ? 'DESC' : 'ASC'})}" th:classappend="${sortBy == 'PRENUME' ? 'active-sort-link' : ''}" class="sort-link">⇅</a></th>
                <th>Naționalitate<a th:href="@{/artisti(q=${search}, sortBy='NATIONALITATE', sortDir=${sortBy == 'NATIONALITATE' and sortDir == 'ASC' ? 'DESC' : 'ASC'})}" th:classappend="${sortBy == 'NATIONALITATE' ? 'active-sort-link' : ''}" class="sort-link">⇅</a></th>
                <th>Vârsta<a th:href="@{/artisti(q=${search}, sortBy='VARSTA', sortDir=${sortBy == 'VARSTA' and sortDir == 'ASC' ? 'DESC' : 'ASC'})}" th:classappend="${sortBy == 'VARSTA' ? 'active-sort-link' : ''}" class="sort-link">⇅</a></th>
                <th>Exp. (Ani)<a th:href="@{/artisti(q=${search}, sortBy='EXPERIENTA', sortDir=${sortBy == 'EXPERIENTA' and sortDir == 'ASC' ? 'DESC' : 'ASC'})}" th:classappend="${sortBy == 'EXPERIENTA' ? 'active-sort-link' : ''}" class="sort-link">⇅</a></th>
                <th th:if="${ses != null and ses.role == 'admin'}">Acțiuni</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="a : ${artistiList}">
                <td th:if="${ses != null and ses.role == 'admin'}" th:text="${a.id}"></td>
                <td th:text="${a.nume}"></td><td th:text="${a.prenume}"></td><td th:text="${a.nationalitate}"></td>
                <td th:text="${a.varsta}"></td><td th:text="${a.experienta}"></td>
                <td th:if="${ses != null and ses.role == 'admin'}">
                    <div class="action-group">
                        <form style='display:inline' method='POST' th:action='@{/artist/delete}' onsubmit="return confirm('Confirmi?')">
                            <input type='hidden' name='id' th:value="${a.id}"/><button class='btn del round'>X</button>
                        </form>
                        <details style='display:inline'>
                            <summary class='btn edit'>Edit</summary>
                            <form method='POST' th:action='@{/artist/edit}' class='form-inline'>
                                <input type='hidden' name='id' th:value="${a.id}"/>
                                <input name='nume' th:value="${a.nume}"/><input name='prenume' th:value="${a.prenume}"/>
                                <input name='nationalitate' th:value="${a.nationalitate}"/><input name='varsta' type="number" th:value="${a.varsta}"/>
                                <input name='experienta' type="number" th:value="${a.experienta}"/>
                                <button class='btn' type='submit'>Salvează</button>
                            </form>
                        </details>
                    </div>
                </td>
            </tr>
            <tr th:if="${artistiList.isEmpty()}"><td th:attr="colspan=${ses != null and ses.role == 'admin' ? 7 : 5}">Nu s-au găsit artiști.</td></tr>
            </tbody>
        </table>
    </div>

    <div style='margin-top:12px;'>
        <a class='link' th:href='@{/spectacole}'>Spectacole</a> |
        <span style="font-weight: bold; color: #555;">Artiști</span> |
        <a class='link' th:href='@{/locatii}'>Locații</a> |
        <a class='link' th:href='@{/organizatori}'>Organizatori</a> |
        <a class='link' th:href='@{/bilete}'>Bilete</a>
        <span th:if="${ses != null and ses.role == 'admin'}"> | <a class='link' th:href='@{/raport}'>Raport</a></span>
    </div>
</div>
</body>
</html>